---
title: java基础-基础加强
date: 2023-07-07
category:
  - JavaSE
---

## 13-1-类加载器和反射

### 01-类加载器-初步了解

将编译后的`class`文件加载到jvm虚拟中

![image-20230707003742191](http://www.iocaop.com/images/2023-07/202307070037224.png)

### 02-类加载器-加载过程

类在什么时候加载到内存中呢？

类加载的时机：

* 创建类的实例
* 调用类的类方法
* 访问类或者接口的类变量(静态变量)，或者为该变量赋值
* 使用反射方式强制创建某个类或接口对应的`java.lang.Class`对象
* 初始化某个类的子类(创建子类对象，需要父类的字节码文件也加载到内存中)
* 直接使用java.exe命令来运行某个主类

总结一句话：<span style="background-color:pink;">用到就加载，不用不加载</span>

### 03-类的加载过程-加载

![image-20230707004142901](http://www.iocaop.com/images/2023-07/202307070041931.png)

加载：

* 通过一个类的全限定名来获取定义此类的二进制字节流(<span style="background-color:pink;">包名+类名，获取这个类，准备用流进行传输</span>)
* 将这个字节流所代表的静态存储结构转化为运行时数据结构(<span style="background-color:pink;">把这个类加载到内存中</span>)
* 在内存中生产一个代表这个类的`java.lang.Class`对象，任何类被使用时，系统都会为之创建一个`java.lang.Class`对象(<span style="background-color:pink;">加载完毕，创建class对象</span>)

### 04-类的加载过程-链接

链接分为三步：验证-准备-解析

**验证**：确保`Class`文件字节流中包含的信息符合当前虚拟机的要求，不会损害虚拟机安全。(<span style="background-color:pink;">验证文件是否符合虚拟机规范，是否安全</span>)

**准备**：负责为类的类变量(静态变量)分配内存，设置默认初始化值。(<span style="background-color:pink;">在刚刚创建的class对象中，初始化静态变量</span>)

**解析**：将类的二进制数据流中的符号引用替换为直接引用。(如果本类用到了其他的类，此时就需要找到对应的类)

假设加载的是`Student`类：

![image-20230707005159077](http://www.iocaop.com/images/2023-07/202307070051099.png)

起初还不知道`String`这个类在哪里，先用符号表示：

![image-20230707005252017](http://www.iocaop.com/images/2023-07/202307070052050.png)

假设`String`如下：

![image-20230707005335462](http://www.iocaop.com/images/2023-07/202307070053480.png)

在`Student`类的加载过程的解析这一步，就会将符号替换成`String`的地址：

![image-20230707005419829](http://www.iocaop.com/images/2023-07/202307070054861.png)